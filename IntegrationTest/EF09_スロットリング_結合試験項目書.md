# EF09_スロットリング_結合試験項目書

### 事前準備

各テストの実行前に、キャッシュを削除しスロットリングの結果をクリアしてください。

以下のコマンドを実行することでキャッシュを削除できます。

```
bin/console cache:pool:clear rate_limiter.cache --env=<APP_ENV>
```

## EF0901-UC01-T01_フロント画面ログイン(IP)

- マイページ＞ログインへアクセスし、ログイン画面を表示する
- 存在しない会員のメールアドレスで、25回ログインに失敗する
- 26回目のログインで、「ログイン試行回数が多すぎます。30分後に再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T02_フロント画面ログイン(会員)

- マイページ＞ログインへアクセスし、ログイン画面を表示する
- 存在する会員のメールアドレスで、5回ログインに失敗する
- 6回目のログインで、「ログイン試行回数が多すぎます。30分後に再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T03_管理画面ログイン(IP)

- 管理画面＞ログインへアクセスし、ログイン画面を表示する
- 存在するメンバーのログインIDで、25回ログインに失敗する
- 26回目のログインで、「ログイン試行回数が多すぎます。30分後に再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T04_管理画面ログイン(メンバー)

- 管理画面＞ログインへアクセスし、ログイン画面を表示する
- 存在するメンバーのログインIDで、5回ログインに失敗する
- 6回目のログインで、「ログイン試行回数が多すぎます。30分後に再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T05_会員登録

- 新規会員登録画面にアクセスし、会員登録を5回行う
- 6回目の会員登録で、完了画面遷移時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T06_問い合わせ

- お問い合わせ画面にアクセスし、問い合わせを5回行う
- 6回目の問い合わせで、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T07_パスワード再発行

- パスワード再発行画面にアクセスし、パスワード再発行画面を5回行う
- 6回目のパスワード再発行画面で、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T08_注文確認_非会員購入

- 非会員で、商品の注文を25回行う
- 26回目の注文で、注文確認画面遷移時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T09_注文確認_会員購入

- 会員ログインした状態で、商品の注文を10回行う
- 11回目の注文で、注文確認画面遷移時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T10_注文完了_非会員購入

※確認画面の試行回数上限に引っかかるため、shopping_confirm_ipおよびshopping_confirm_customerのlimitを変更すること(https://github.com/EC-CUBE/ec-cube/blob/4.2/app/config/eccube/packages/prod/eccube_rate_limiter.yaml)

- 非会員で、商品の注文を25回行う
- 26回目の注文で、注文完了画面遷移時に、「購入処理で予期しないエラーが発生しました。恐れ入りますがお問い合わせページよりご連絡ください。」のエラーが表示されることを確認する

## EF0901-UC01-T11_注文完了_会員購入

※確認画面の試行回数上限に引っかかるため、shopping_confirm_ipおよびshopping_confirm_customerのlimitを変更すること(https://github.com/EC-CUBE/ec-cube/blob/4.2/app/config/eccube/packages/prod/eccube_rate_limiter.yaml)

- 会員ログインした状態で、商品の注文を10回行う
- 11回目の注文で、注文完了画面遷移時に、「購入処理で予期しないエラーが発生しました。恐れ入りますがお問い合わせページよりご連絡ください。」のエラーが表示されることを確認する

## EF0901-UC01-T12_会員情報編集

- 会員ログインした状態で、会員情報編集を10回行う
    - 実際に情報を変更する必要はなし
- 11回目の会員情報編集画面遷移時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T13_配送先情報_追加

- 会員ログインした状態で、配送先情報の追加（新規お届け先を追加する）を10回行う
- 11回目の配送先情報追加時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T14_配送先情報_編集

- 会員ログインした状態で、配送先情報の編集（変更）を10回行う
- 11回目の配送先情報変更時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T15_配送先情報_削除

※確認画面の試行回数上限に引っかかるため、mypage_delivery_newのlimitを変更すること(https://github.com/EC-CUBE/ec-cube/blob/4.2/app/config/eccube/packages/prod/eccube_rate_limiter.yaml)

- 会員ログインした状態で、配送先情報の追加（新規お届け先を追加する）を10回行う
- その後、上記で登録した配送先情報の削除を順番に10回行う
- 11回目の配送先情報削除時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T16_order_お届け先追加

- 会員ログインした状態で、注文の確認画面まで進む
- 確認画面からお届け先追加を10回行なう
- 11回目のお届け先追加時に、「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する

## EF0901-UC01-T18_会員登録_入力
- 新規会員登録画面にアクセスし、会員登録（エラーとなるパターン）を25回行う
- 26回目の会員登録で、「ログイン試行回数が多すぎます。30分後に再度お試しください。」のエラーが表示されることを確認する

## EF0902-UC01-T01_プラグインを削除後スロットリングが機能することを確認する

[EC-CUBE/ec-cube#5957](https://github.com/EC-CUBE/ec-cube/issues/5957)

1. 管理画面にてオーナーズストアから、任意のプラグインをインストール→アンインストールをおこなう
1. フロント画面にて会員ログインしていない状態で、ログイン画面→パスワードの再発行を実行する（スロットリングが設定されている機能を実行）
1. システムエラーが発生することなく、再発行完了の画面に遷移できることを確認する

## EF0902-UC01-T02_管理画面ログイン_二段階認証でスロットリングが機能することを確認する

- 管理画面にてメンバー管理から、ユーザの2段階認証を有効化する
- 2段階認証を有効化したユーザで管理画面へログイン、トークン入力画面へ進む
- トークン入力画面で5回トークン入力間違いを実行する。（トークン入力 -> 認証ボタンクリック）
- 6回目の認証ボタンクリックで「試行回数の上限を超過しました。しばらくお待ちいただき、再度お試しください。」のエラーが表示されることを確認する
